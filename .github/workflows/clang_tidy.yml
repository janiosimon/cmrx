name: Clang-Tidy
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  clang-tidy-v6m:
    name: Clang-Tidy ARMv6M
    runs-on: ubuntu-latest
    steps:
     - name: Install development packages
       run: |
          sudo apt-get update
          sudo apt-get install -y libnewlib-dev

     - name: Checkout
       uses: actions/checkout@v4.1.6
       with:
        submodules: 'true'

     - name: Configure the Build
       uses: threeal/cmake-action@main
       with:
        c-compiler: clang
        run-build: false
        build-dir: static_analysis
        source-dir: testing/clang-tidy
        options: |
          CMRX_TARGET_PLATFORM=ARMv6M
          CMRX_UNIT_TESTS=OFF
          CMRX_CLANG_TIDY_LIBC_PATH=/usr/include/newlib

     - name: Run Static Analysis
       run: cmake --build static_analysis -- clang-tidy

  clang-tidy-v7m:
    name: Clang-Tidy ARMv7M
    runs-on: ubuntu-latest
    steps:
     - name: Install development packages
       run: |
          sudo apt-get update
          sudo apt-get install -y libnewlib-dev

     - name: Checkout
       uses: actions/checkout@v4.1.6
       with:
        submodules: 'true'

     - name: Configure the Build
       uses: threeal/cmake-action@main
       with:
        c-compiler: clang
        run-build: false
        build-dir: static_analysis
        source-dir: testing/clang-tidy
        options: |
          CMRX_TARGET_PLATFORM=ARMv7M
          CMRX_UNIT_TESTS=OFF
          CMRX_CLANG_TIDY_LIBC_PATH=/usr/include/newlib

     - name: Run Static Analysis
       run: cmake --build static_analysis -- clang-tidy

  clang-tidy-v7mf:
    name: Clang-Tidy ARMv7M-F
    runs-on: ubuntu-latest
    steps:
     - name: Install development packages
       run: |
          sudo apt-get update
          sudo apt-get install -y libnewlib-dev

     - name: Checkout
       uses: actions/checkout@v4.1.6
       with:
        submodules: 'true'

     - name: Configure the Build
       uses: threeal/cmake-action@main
       with:
        c-compiler: clang
        run-build: false
        build-dir: static_analysis
        source-dir: testing/clang-tidy
        options: |
          CMRX_TARGET_PLATFORM=ARMv7MF
          CMRX_UNIT_TESTS=OFF
          CMRX_CLANG_TIDY_LIBC_PATH=/usr/include/newlib

     - name: Run Static Analysis
       run: cmake --build static_analysis -- clang-tidy
